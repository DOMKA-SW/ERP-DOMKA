<!-- Crea check-users.html en la raíz del proyecto -->
<!DOCTYPE html>
<html>
<head>
    <title>Verificación de Usuarios - DOMKA ERP</title>
    <script type="module">
        import { auth } from './services/auth.js';
        import { doc, getDoc, setDoc, getFirestore } from './services/firebase-config.js';
        
        const db = getFirestore();
        
        async function checkUsers() {
            try {
                const user = auth.currentUser;
                if (!user) {
                    alert('Por favor inicia sesión primero');
                    window.location.href = '/modules/auth/index.html';
                    return;
                }
                
                console.log("Usuario actual:", user.uid, user.email);
                
                // Verificar documento del usuario actual
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    console.log("Documento de usuario encontrado:", userDoc.data());
                    
                    if (userDoc.data().role === 'superadmin') {
                        alert('¡Ya eres Super Admin!');
                        window.location.href = '/modules/superadmin/index.html';
                    } else {
                        alert('Tienes rol: ' + userDoc.data().role);
                        document.getElementById('makeAdminBtn').style.display = 'block';
                    }
                } else {
                    console.log("No existe documento de usuario");
                    document.getElementById('createUserBtn').style.display = 'block';
                }
                
                // Listar todos los usuarios
                const usersSnapshot = await getDocs(collection(db, "users"));
                console.log("Total de usuarios en la base de datos:", usersSnapshot.size);
                
                usersSnapshot.forEach((doc) => {
                    console.log("Usuario:", doc.id, doc.data());
                });
                
            } catch (error) {
                console.error('Error:', error);
                alert('Error: ' + error.message);
            }
        }
        
        async function makeUserAdmin() {
            try {
                const user = auth.currentUser;
                await setDoc(doc(db, "users", user.uid), {
                    name: user.email.split('@')[0],
                    email: user.email,
                    role: 'superadmin',
                    createdAt: new Date(),
                    lastLogin: new Date()
                }, { merge: true });
                
                alert('¡Ahora eres Super Admin!');
                window.location.href = '/modules/superadmin/index.html';
            } catch (error) {
                console.error('Error:', error);
                alert('Error: ' + error.message);
            }
        }
        
        async function createUserDocument() {
            try {
                const user = auth.currentUser;
                await setDoc(doc(db, "users", user.uid), {
                    name: user.email.split('@')[0],
                    email: user.email,
                    role: 'user', // Rol por defecto
                    createdAt: new Date(),
                    lastLogin: new Date()
                });
                
                alert('Documento de usuario creado. Recarga la página.');
                window.location.reload();
            } catch (error) {
                console.error('Error:', error);
                alert('Error: ' + error.message);
            }
        }
        
        // Ejecutar cuando la página cargue
        document.addEventListener('DOMContentLoaded', checkUsers);
        document.getElementById('makeAdminBtn').addEventListener('click', makeUserAdmin);
        document.getElementById('createUserBtn').addEventListener('click', createUserDocument);
    </script>
</head>
<body>
    <div style="padding: 20px; font-family: Arial, sans-serif;">
        <h1>Verificación de Usuarios DOMKA ERP</h1>
        <div id="userInfo">Cargando información del usuario...</div>
        <button id="makeAdminBtn" style="padding: 10px 20px; margin: 10px; display: none;">
            Convertir en Superadmin
        </button>
        <button id="createUserBtn" style="padding: 10px 20px; margin: 10px; display: none;">
            Crear Documento de Usuario
        </button>
        <div id="results" style="margin-top: 20px;"></div>
    </div>
</body>
</html>
